<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dust to Dust</title>
</head>
  <script src="pixi.min.js"></script>
<body>
  <style>* {padding: 0; margin: 0}</style>
  <script type="text/javascript">
    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){type = "canvas"}
    PIXI.utils.sayHello(type)
    
    let Application = PIXI.Application,
    loader = PIXI.loader,
    resources = PIXI.loader.resources,
    Sprite = PIXI.Sprite;
    
    let app = new Application({width: 1024, height: 1024});
    document.body.appendChild(app.view);
    
    app.renderer.view.style.position = "absolute";
    app.renderer.view.style.display = "block";
    app.renderer.autoResize = true;
    app.renderer.resize(window.innerWidth, window.innerHeight);

    loader
      .add("Odyssey.jpg")
      .load(setup);

    let sprite, state;
    
    function setup() {
      sprite = new Sprite(resources["Odyssey.jpg"].texture);
      app.stage.addChild(sprite);
      sprite.position.set(window.innerWidth/2, window.innerHeight/2);
      sprite.scale.set(0.1, 0.2);
      sprite.anchor.set(0.5, 0,5);
      sprite.vx = 0;
      sprite.vy = 0;
      
      let left = keyboard("ArrowLeft"),
        up = keyboard("ArrowUp"),
        right = keyboard("ArrowRight"),
        down = keyboard("ArrowDown");

      left.press = () => {
        sprite.vx = -5;
        sprite.vy = 0;
      };
  
      left.release = () => {
        if (!right.isDown && cat.vy === 0) {
          sprite.vx = 0;
        }
      };

      up.press = () => {
        sprite.vy = -5;
        sprite.vx = 0;
      };
      up.release = () => {
        if (!down.isDown && cat.vx === 0) {
          sprite.vy = 0;
        }
      };

      right.press = () => {
        sprite.vx = 5;
        sprite.vy = 0;
      };
      right.release = () => {
        if (!left.isDown && cat.vy === 0) {
          sprite.vx = 0;
        }
      };

      down.press = () => {
        sprite.vy = 5;
        sprite.vx = 0;
      };
      down.release = () => {
        if (!up.isDown && cat.vx === 0) {
          sprite.vy = 0;
        }
      };
      
      state = play;
      
      app.ticker.add(delta => gameLoop(delta));
    }
    
    function gameLoop(delta) {
      state(delta);
    }
    
    function play(delta) {
      sprite.y += sprite.vy
      sprite.x += sprite.vx
    }
    
//    function keyboard(keyCode) {
//      var key = {};
//      key.code = keyCode;
//      key.isDown = false;
//      key.isUp = true;
//      key.press = undefined;
//      key.release = undefined;
//
//      key.downHandler = event => {
//        if (event.keyCode === key.code) {
//          if (key.isUp && key.press) key.press();
//          key.isDown = true;
//          key.isUp = false;
//        }
//        event.preventDefault();
//      };
//
//      key.upHandler = event => {
//        if (event.keyCode === key.code) {
//          if (key.isDown && key.release) key.release();
//          key.isDown = false;
//          key.isUp = true;
//        }
//        event.preventDefault();
//      };
//
//      window.addEventListener("keydown", key.downHandler.bind(key), false);
//      window.addEventListener("keyup", key.upHandler.bind(key), false);
//      return key;
//    }
  </script>
</body>
</html>
