<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dust to Dust</title>
</head>
<body>
  <script src="pixi.min.js"></script>
  <script type="text/javascript">
    let Container = PIXI.Container, autoDetectRenderer = PIXI.autoDetectRenderer, Sprite = PIXI.Sprite, loader = PIXI.loader, resources = PIXI.loader.resources
    
    let stage = new Container(),
        renderer = autoDetectRenderer(window.innerHeight - 16, window.innerHeight - 16);
    document.body.appendChild(renderer.view);

    renderer.view.style.border = "1px dashed black";
    renderer.backgroundColor = "0xFFFFFF";
    document.body.style.overflow = "hidden";
    document.body.style.background-color = "black";

    loader
      .add("Odyssey.jpg")
      .load(setup);

    let sprite, state;
    
    function setup() {
      sprite = new Sprite(resources["Odyssey.jpg"].texture);
      
      sprite.x = renderer.view.width / 2 - sprite.width / 2;
      sprite.y = renderer.view.width / 2 - sprite.height / 2;
      sprite.vx = 0;
      sprite.vy = 0;
      
      stage.addChild(sprite);
      
      var left = keyboard(37), up = keyboard(38), right = keyboard(39), down = keyboard(40);

      left.press = () => {sprite.vx = -5; sprite.vy = 0;};
      left.release = () => {if (!right.isDown && sprite.vy === 0) {sprite.vx = 0;}};

      up.press = () => {sprite.vy = -5; sprite.vx = 0;};
      up.release = () => {if (!down.isDown && sprite.vx === 0) {sprite.vy = 0;}};

      right.press = () => {sprite.vx = 5; sprite.vy = 0;};
      right.release = () => {if (!left.isDown && sprite.vy === 0) {sprite.vx = 0;}};

      down.press = () => {sprite.vy = 5;sprite.vx = 0;};
      down.release = () => {if (!up.isDown && sprite.vx === 0) {sprite.vy = 0;}};
      
      state = play;
      
      gameLoop();
    }
    
    function gameLoop() {
      requestAnimationFrame(gameLoop);
      
      state();
      
      renderer.render(stage);
    }
    
    function play() {
      sprite.y += sprite.vy
      sprite.x += sprite.vx
    }
    
    function keyboard(keyCode) {
      var key = {};
      key.code = keyCode;
      key.isDown = false;
      key.isUp = true;
      key.press = undefined;
      key.release = undefined;

      key.downHandler = function(event) {
        if (event.keyCode === key.code) {if (key.isUp && key.press) key.press(); key.isDown = true; key.isUp = false;}
        event.preventDefault();
      };

      key.upHandler = function(event) {
        if (event.keyCode === key.code) {if (key.isDown && key.release) key.release(); key.isDown = false; key.isUp = true;}
        event.preventDefault();
      };

      window.addEventListener("keydown", key.downHandler.bind(key), false);
      window.addEventListener("keyup", key.upHandler.bind(key), false);

      return key;
    }
  </script>
</body>
</html>
